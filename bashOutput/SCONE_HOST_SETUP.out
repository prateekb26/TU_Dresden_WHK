

To verify that a host is properly installed for SCONE and contains the newest patched Docker engine and SGX driver, just execute:


This command will issue an error unless the newest versions of the patched Docker engine and the patched SGX driver is installed.

## Installation of a swarm

For a set of hosts to form a (Docker) swarm, you need to decide which hosts should be managers and which should be just members of the swarm. Say, you decided that *alice* and *bob* should be managers but *caroline* a non-manager, execute the following:


Note that the hosts must be able to communicate with each other (i.e., not partitioned through firewalls). Docker recommends/expects  that they will be in the same local area network.

#### Checking your Installation

To test the installation, one can run a simple hello-world container:


## Background Information 

### Patched Docker Engine (Moby)

For an container to be able to use SGX, it has to have access to a device (/dev/isgx). This device permits the container to talk to the SGX driver. This driver is needed, in particular, to create SGX enclaves. 

Some docker commands (like *docker run*) support an option --device (i.e., *--device /dev/isgx*) which allows us to give a container access to the SGX device. We need to point out that some docker commands (like *docker build*) do, however, not yet support the device option. Therefore, we maintain and install a slightly patched docker engine (i.e., a variant of moby): this engine ensures that each container has access to the SGX device (/dev/isgx).  With the help of this patched engine, we can use Dockerfiles to generate container images (see this [Tutorial](SCONE_Dockerfile.md)).

Right now we provide a patched version of the currently active branch of Moby (a.k.a., the Docker engine): 17.05.0-ce, build 89658be (November 11, 2017).

### Patched SGX Driver

We also maintain a patched version of the SGX driver. This version adds some additional monitoring like the number of *available* and *free* EPC (Extended Page Cache) pages.

Right now, we provide a patched version of the latest Intel SGX driver (November 11, 2017).


### Note

We have been updating SCONE such that SCONE does not need access to **/dev/isgx** during cross-compilation - which could, for example, be executed during *docker build*. Hence, we will soon switch to an unpatched Docker engine and SGX driver.

### Screencast

This screencast shows the installation of three machines SGX-capable hosts. In this screencast, we show the installation on machines that run older versions of Ubuntu (sgx2 = 14.04, sgx3 = 14.04 with custom kernel, and sgx4 = 16.04). In this case, we will see some warnings since *scone host* depends on *systemd* to start the swarm. In case *systemd* is not available, *scone host* will still be able to install the patched SGX driver and the patched Docker engine.

Another issue that one sometimes faces is that an older SGX drivers is already installed but cannot be offloaded and replaced by the patched driver by *scone host*. The reason for that is that typically that some process is still using the */dev/isgx* device. This needs to be manually fixed by stopping the process or by rebooting the machine. Alternatively, one can use the existing SGX driver. However, the monitoring of the used EPC pages will not be provided in this case.

[![asciicast](https://asciinema.org/a/CixThoNCAciq132ZAwSZ8kZ22.png)](https://asciinema.org/a/CixThoNCAciq132ZAwSZ8kZ22)

&copy; [scontain.com](http://www.scontain.com), March 2018. [Questions or Suggestions?](mailto:info@scontain.com)